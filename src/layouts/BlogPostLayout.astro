---
import Layout from './Layout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import PostNavigation from '../components/blog/PostNavigation.astro';

interface Props {
  frontmatter: {
    title: string;
    publishDate: Date;
    author: string;
    excerpt: string;
    tags?: string[];
    readTime?: string;
  };
  prevPost?: {
    slug: string;
    title: string;
  };
  nextPost?: {
    slug: string;
    title: string;
  };
}

const { frontmatter, prevPost, nextPost } = Astro.props;

// Format date
const formattedDate = new Intl.DateTimeFormat('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}).format(new Date(frontmatter.publishDate));

// Get canonical URL for this post
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const siteURL = Astro.site?.toString() || 'https://civiq.design';

// Article schema for SEO
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": frontmatter.title,
  "description": frontmatter.excerpt,
  "datePublished": new Date(frontmatter.publishDate).toISOString(),
  "author": {
    "@type": "Person",
    "name": frontmatter.author,
    "url": "https://www.linkedin.com/in/brianhendrick/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Civiq Design",
    "logo": {
      "@type": "ImageObject",
      "url": `${siteURL}/civiq-design-logo-full-color-rgb.svg`
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalURL.toString()
  },
  ...(frontmatter.tags && { "keywords": frontmatter.tags.join(", ") })
};
---

<Layout title={`${frontmatter.title} — Civiq Design`} description={frontmatter.excerpt} jsonLd={articleSchema}>
  <Navigation />

  <a href="#main-content" class="skip-link">Skip to main content</a>

  <main id="main-content" class="pt-16">
    <!-- Blog Post Header -->
    <section class="py-16 sm:py-20" style="background-color: var(--color-rice-white);">
      <div class="mx-auto px-6 sm:px-8 lg:px-12" style="max-width: 680px;">
        <!-- Back link -->
        <a
          href="/insights"
          class="inline-flex items-center gap-2 mb-8 text-sm transition-opacity duration-200"
          style="color: var(--color-forest-green); opacity: 0.7;"
          onmouseover="this.style.opacity='1'"
          onmouseout="this.style.opacity='0.7'"
        >
          <span aria-hidden="true">←</span>
          <span>Back to Insights</span>
        </a>

        <!-- Meta info -->
        <div class="flex items-center gap-3 mb-6 text-sm" style="color: var(--color-forest-green); opacity: 0.6;">
          <span>{formattedDate}</span>
          {frontmatter.readTime && (
            <>
              <span>•</span>
              <span>{frontmatter.readTime}</span>
            </>
          )}
        </div>

        <!-- Title -->
        <h1 class="text-3xl sm:text-4xl lg:text-5xl mb-6 headline-balance" style="color: var(--color-forest-green); font-weight: var(--font-weight-medium); letter-spacing: -0.02em; line-height: 1.15;">
          {frontmatter.title}
        </h1>

        <!-- Tags -->
        {frontmatter.tags && frontmatter.tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-6">
            {frontmatter.tags.map(tag => (
              <span
                class="inline-block px-3 py-1 text-xs rounded-full"
                style="background-color: rgba(18, 64, 69, 0.08); color: var(--color-forest-green); font-weight: var(--font-weight-medium);"
              >
                {tag}
              </span>
            ))}
          </div>
        )}

        <!-- Author -->
        <p class="text-sm" style="color: var(--color-forest-green); opacity: 0.6;">
          By {frontmatter.author}
        </p>
      </div>
    </section>

    <!-- Article Content -->
    <article class="py-16 sm:py-20" style="background-color: var(--color-white);">
      <div class="mx-auto px-6 sm:px-8 lg:px-12 prose prose-lg max-w-none" style="max-width: 680px;">
        <slot />
      </div>
    </article>

    <PostNavigation prevPost={prevPost} nextPost={nextPost} />
  </main>

  <Footer />
</Layout>

<style>
  /* Prose styling for markdown content */
  .prose {
    color: var(--color-forest-green);
  }

  .prose h2 {
    font-family: var(--font-primary);
    font-size: var(--text-h2);
    font-weight: var(--font-weight-semibold);
    color: var(--color-forest-green);
    letter-spacing: -0.01em;
    line-height: 1.2;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
  }

  .prose h2:first-child {
    margin-top: 0;
  }

  .prose h3 {
    font-family: var(--font-primary);
    font-size: var(--text-h3);
    font-weight: var(--font-weight-semibold);
    color: var(--color-forest-green);
    letter-spacing: -0.01em;
    line-height: 1.25;
    margin-top: 2.5rem;
    margin-bottom: 1.25rem;
  }

  .prose p {
    font-family: var(--font-primary);
    font-size: var(--text-body);
    font-weight: var(--font-weight-regular);
    line-height: 1.6;
    margin-bottom: 1.5rem;
    color: var(--color-forest-green);
    opacity: 0.85;
  }

  .prose strong {
    font-weight: var(--font-weight-semibold);
    color: var(--color-forest-green);
    opacity: 1;
  }

  .prose ul, .prose ol {
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }

  .prose li {
    margin-bottom: 0.75rem;
    line-height: 1.7;
  }

  .prose a {
    color: var(--color-warm-clay);
    text-decoration: none;
    transition: color 0.2s;
  }

  .prose a:hover {
    color: #C4624A;
    text-decoration: underline;
  }

  .prose blockquote {
    border-left: 4px solid var(--color-warm-clay);
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: var(--color-forest-green);
    opacity: 0.9;
  }

  .prose hr {
    border: none;
    border-top: 1px solid var(--color-grey-d);
    margin: 3rem 0;
  }

  .prose code {
    background-color: rgba(18, 64, 69, 0.05);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.9em;
  }

  .prose em {
    font-style: italic;
  }

  /* Mobile adjustments */
  @media (max-width: 768px) {
    .prose h2 {
      font-size: 1.5rem;
    }

    .prose h3 {
      font-size: 1.25rem;
    }

    .prose p {
      font-size: 1rem;
    }
  }
</style>
