---
import BlogPostLayout from '../../layouts/BlogPostLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = (await getCollection('blog'))
    .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

  return posts.map((post, index) => {
    // Get prev/next posts (chronological order)
    const nextPost = index > 0 ? posts[index - 1] : null;  // Newer post
    const prevPost = index < posts.length - 1 ? posts[index + 1] : null;  // Older post

    return {
      params: { slug: post.slug },
      props: {
        post,
        prevPost: prevPost ? {
          slug: prevPost.slug,
          title: prevPost.data.title,
        } : undefined,
        nextPost: nextPost ? {
          slug: nextPost.slug,
          title: nextPost.data.title,
        } : undefined,
      },
    };
  });
}

const { post, prevPost, nextPost } = Astro.props;
const { Content } = await post.render();
---

<BlogPostLayout frontmatter={post.data} prevPost={prevPost} nextPost={nextPost}>
  <Content />
</BlogPostLayout>
